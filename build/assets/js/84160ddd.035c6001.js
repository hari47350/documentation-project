"use strict";(self.webpackChunkproject_docs=self.webpackChunkproject_docs||[]).push([[2186],{1990:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>m,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"modules/module1/teamA/week4","title":"Week 04 \u2014 Teama","description":"SmartIDH3 Multi\\\\-Tenant Seeder Documentation","source":"@site/docs/modules/module1/teamA/week4.md","sourceDirName":"modules/module1/teamA","slug":"/modules/module1/teamA/week4","permalink":"/docs/modules/module1/teamA/week4","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"week4","title":"Week 04 \u2014 Teama","sidebar_label":"Week 04"},"sidebar":"docsSidebar","previous":{"title":"Week 03","permalink":"/docs/modules/module1/teamA/week3"},"next":{"title":"Week1","permalink":"/docs/modules/module1/teamB/week1"}}');var r=t(4848),a=t(8453);const d={id:"week4",title:"Week 04 \u2014 Teama",sidebar_label:"Week 04"},i="1. Project Structure",o={},l=[];function c(e){const n={br:"br",code:"code",h1:"h1",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"SmartIDH3 Multi-Tenant Seeder Documentation"}),"\n",(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"1-project-structure",children:"1. Project Structure"})}),"\n",(0,r.jsxs)(n.p,{children:["smartidh3/",(0,r.jsx)(n.br,{}),"\n","\u2502",(0,r.jsx)(n.br,{}),"\n","\u251c\u2500\u2500 backend/",(0,r.jsx)(n.br,{}),"\n","\u2502   \u251c\u2500\u2500 routes/",(0,r.jsx)(n.br,{}),"\n","\u2502   \u2502   \u251c\u2500\u2500 auth.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u2502   \u2514\u2500\u2500 documents.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u251c\u2500\u2500 utils/",(0,r.jsx)(n.br,{}),"\n","\u2502   \u2502   \u251c\u2500\u2500 __init__.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u2502   \u2514\u2500\u2500 jwt_utils.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u2514\u2500\u2500 seed_demo.py",(0,r.jsx)(n.br,{}),"\n","\u251c\u2500\u2500 tests/",(0,r.jsx)(n.br,{}),"\n","\u2502   \u251c\u2500\u2500 test_auth.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u251c\u2500\u2500 test_chroma_service.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u251c\u2500\u2500 test_demo_tenant.py",(0,r.jsx)(n.br,{}),"\n","\u2502   \u2514\u2500\u2500 test_seed_demo.py",(0,r.jsx)(n.br,{}),"\n","\u251c\u2500\u2500 .venv/",(0,r.jsx)(n.br,{}),"\n","\u251c\u2500\u2500 requirements.txt",(0,r.jsx)(n.br,{}),"\n","\u2514\u2500\u2500 README.md"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 1"',children:'<a id="seed-script-seed_demo.py"></a># 2\\. Seed Script \\(seed\\_demo\\.py\\)\r\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:['"""',(0,r.jsx)(n.br,{}),"\n","Seed demo tenants and users into MongoDB.",(0,r.jsx)(n.br,{}),"\n","Ensures idempotent insertion using upsert.",(0,r.jsx)(n.br,{}),"\n",'"""']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="week4.md snippet 2"',children:"from pymongo import MongoClient  \r\n  \n"})}),"\n",(0,r.jsx)(n.p,{children:"# Database Connection"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 3"',children:'client = MongoClient\\("mongodb://admin:StrongPassword123\\!@localhost:27017"\\)  \n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="1. Project Structure"',children:'db = client\\["multitenant"\\]  \r\n  \n'})}),"\n",(0,r.jsx)(n.p,{children:"# Seed Tenants"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="1. Project Structure"',children:"tenants = \\[  \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 4"',children:'    \\{"\\_id": "tenant\\_acme", "name": "Acme Inc"\\},  \r\n    \\{"\\_id": "tenant\\_beta", "name": "Beta Corp"\\}  \n'})}),"\n",(0,r.jsx)(n.p,{children:"]"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 5"',children:'for tenant in tenants:  \r\n    db\\["tenants"\\]\\.update\\_one\\(\\{"\\_id": tenant\\["\\_id"\\]\\}, \\{"$set": tenant\\}, upsert=True\\)  \r\n  \n'})}),"\n",(0,r.jsx)(n.p,{children:"# Seed Users"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="1. Project Structure"',children:"users = \\[  \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 6"',children:'    \\{"email": "alice@acme\\.com", "password": "1234", "tenant\\_id": "tenant\\_acme"\\},  \r\n    \\{"email": "bob@beta\\.com", "password": "1234", "tenant\\_id": "tenant\\_beta"\\}  \n'})}),"\n",(0,r.jsx)(n.p,{children:"]"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 7"',children:'for user in users:  \r\n    db\\["users"\\]\\.update\\_one\\(\\{"email": user\\["email"\\]\\}, \\{"$set": user\\}, upsert=True\\)  \r\n  \r\nprint\\("Demo tenants/users seeded successfully\\."\\)\r\n\r\n<a id="test-script-teststest_seed_demo.py"></a># 3\\. Test Script \\(tests/test\\_seed\\_demo\\.py\\)\r\n\r\nimport pytest  \r\nimport backend\\.seed\\_demo as seed\\_demo  \r\n  \n'})}),"\n",(0,r.jsx)(n.p,{children:"@pytest.fixture"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="week4.md snippet 8"',children:'def fake\\_mongo\\(monkeypatch\\):  \r\n    """Mock MongoDB client and collections used in seed\\_demo\\."""  \r\n  \r\n    class FakeCollection:  \r\n        def \\_\\_init\\_\\_\\(self\\):  \r\n            self\\.data = \\{\\}  \r\n        def update\\_one\\(self, filter\\_query, update\\_query, upsert=False\\):  \r\n            key = filter\\_query\\.get\\("\\_id"\\) or filter\\_query\\.get\\("email"\\)  \r\n            self\\.data\\[key\\] = update\\_query\\["$set"\\]  \r\n  \r\n    class FakeDB:  \r\n        def \\_\\_init\\_\\_\\(self\\):  \r\n            self\\.collections = \\{"tenants": FakeCollection\\(\\), "users": FakeCollection\\(\\)\\}  \r\n        def \\_\\_getitem\\_\\_\\(self, name\\):  \r\n            return self\\.collections\\[name\\]  \r\n  \r\n    fake\\_db = FakeDB\\(\\)  \r\n    monkeypatch\\.setattr\\(seed\\_demo, "db", fake\\_db\\)  \r\n    return fake\\_db  \r\n  \r\n  \r\ndef test\\_seed\\_demo\\_inserts\\_correct\\_data\\(fake\\_mongo\\):  \r\n    """Ensure tenants and users are inserted correctly\\."""  \r\n    for tenant in seed\\_demo\\.tenants:  \r\n        fake\\_mongo\\["tenants"\\]\\.update\\_one\\(\\{"\\_id": tenant\\["\\_id"\\]\\}, \\{"$set": tenant\\}, upsert=True\\)  \r\n    for user in seed\\_demo\\.users:  \r\n        fake\\_mongo\\["users"\\]\\.update\\_one\\(\\{"email": user\\["email"\\]\\}, \\{"$set": user\\}, upsert=True\\)  \r\n  \r\n    tenants = fake\\_mongo\\["tenants"\\]\\.data  \r\n    users = fake\\_mongo\\["users"\\]\\.data  \r\n  \r\n    assert len\\(tenants\\) == 2  \r\n    assert "tenant\\_acme" in tenants  \r\n    assert "tenant\\_beta" in tenants  \r\n  \r\n    assert len\\(users\\) == 2  \r\n    assert users\\["alice@acme\\.com"\\]\\["tenant\\_id"\\] == "tenant\\_acme"  \r\n    assert users\\["bob@beta\\.com"\\]\\["tenant\\_id"\\] == "tenant\\_beta"  \r\n  \r\n  \r\ndef test\\_seed\\_demo\\_idempotency\\(fake\\_mongo\\):  \r\n    """Ensure running the seeder twice does not duplicate entries\\."""  \r\n    for \\_ in range\\(2\\):  \r\n        for tenant in seed\\_demo\\.tenants:  \r\n            fake\\_mongo\\["tenants"\\]\\.update\\_one\\(\\{"\\_id": tenant\\["\\_id"\\]\\}, \\{"$set": tenant\\}, upsert=True\\)  \r\n        for user in seed\\_demo\\.users:  \r\n            fake\\_mongo\\["users"\\]\\.update\\_one\\(\\{"email": user\\["email"\\]\\}, \\{"$set": user\\}, upsert=True\\)  \r\n  \r\n    assert len\\(fake\\_mongo\\["tenants"\\]\\.data\\) == 2  \r\n    assert len\\(fake\\_mongo\\["users"\\]\\.data\\) == 2\r\n\n'})}),"\n",(0,r.jsx)(n.h1,{id:"4-running-tests",children:"4. Running Tests"}),"\n",(0,r.jsxs)(n.p,{children:["# Activate virtual environment",(0,r.jsx)(n.br,{}),"\n",".venv\\Scripts\\activate"]}),"\n",(0,r.jsx)(n.p,{children:"# Set PYTHONPATH"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 9"',children:'$env:PYTHONPATH="C:\\\\Users\\\\admin\\\\smartidh3"  \r\n  \n'})}),"\n",(0,r.jsx)(n.p,{children:"# Run tests"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="4. Running Tests"',children:"python \\-m pytest tests/test\\_seed\\_demo\\.py \\-v\r\n\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 10"',children:"Expected output:\r\n\r\ntests/test\\_seed\\_demo\\.py::test\\_seed\\_demo\\_inserts\\_correct\\_data PASSED  \r\n tests/test\\_seed\\_demo\\.py::test\\_seed\\_demo\\_idempotency PASSED\r\n\n"})}),"\n",(0,r.jsx)(n.h1,{id:"5-best-practices",children:"5. Best Practices"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Keep seed scripts ",(0,r.jsx)(n.strong,{children:"idempotent"})," using upsert=True."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.strong,{children:"monkeypatch or mocks"})," to isolate database dependencies in tests."]}),"\n",(0,r.jsxs)(n.li,{children:["Include ",(0,r.jsx)(n.strong,{children:"docstrings"})," for clarity."]}),"\n",(0,r.jsxs)(n.li,{children:["Separate ",(0,r.jsx)(n.strong,{children:"demo data"})," from production data."]}),"\n",(0,r.jsxs)(n.li,{children:["Optionally, add ",(0,r.jsx)(n.strong,{children:"logging"})," to track seeding."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title="week4.md snippet 11"',children:'<a id="seeder-flow-diagram-optional"></a># 6\\. Seeder Flow Diagram \\(Optional\\)\r\n\r\n__Seeder Flow:__ 1\\. Connect to MongoDB\\. 2\\. Iterate tenants and users\\. 3\\. Upsert each document\\. 4\\. Print completion message\\.\r\n\r\n__Test Flow:__ 1\\. Monkeypatch db with FakeDB\\. 2\\. Run seed logic\\. 3\\. Assert data is inserted correctly\\. 4\\. Assert idempotency\\.\r\n\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Document Complete"})})]})}function m(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>i});var s=t(6540);const r={},a=s.createContext(r);function d(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);